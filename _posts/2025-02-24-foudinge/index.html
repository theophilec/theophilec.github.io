<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Mapping the French Culinary Network | Théophile Cantelobre </title> <meta name="author" content="Théophile Cantelobre"> <meta name="description" content="Creating a knowledge graph of restaurants featured in lefooding.com reviews using `outlines` and `gpt4o-mini`."> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%9A%80&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://theophilec.github.io/_posts/2025-02-24-foudinge/"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Théophile</span> Cantelobre </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Mapping the French Culinary Network</h1> <p class="post-meta"> February 27, 2025 </p> <p class="post-tags"> <i class="fa-solid fa-calendar fa-sm"></i> 2025   ·   <i class="fa-solid fa-tag fa-sm"></i> llm food   </p> </header> <article class="post-content"> <div id="markdown-content"> <blockquote> <p>_This post has been shared by .txt on <a href="https://www.linkedin.com/posts/dottxt_heres-an-impressive-real-world-application-activity-7301322258201923584-01K5?utm_source=share&amp;utm_medium=member_desktop&amp;rcm=ACoAACOfhn4Byev3cgLMB0m80WAJqy6BUm_-NM4" rel="external nofollow noopener" target="_blank">Linkedin</a> and <a href="https://bsky.app/profile/dottxtai.bsky.social/post/3ljb5a7hriq2y" rel="external nofollow noopener" target="_blank">Bluesky</a>.</p> </blockquote> <p>For French restaurant intel, <a href="https://lefooding.com" rel="external nofollow noopener" target="_blank">lefooding.com</a> is the definitive data source. Their anonymous critics conduct systematic reviews of establishments across France (and now Belgium), documenting their findings in a witty - if peculiar - style. Beyond choosing the place for a delicious night out, they can be used to map and understand France’s culinary network.</p> <p>A network is composed of nodes and edges. Nodes represent entities, such as people or restaurants. Edges represent the relationships between people and restaurants, or absence thereof. For the French restaurant scene, nodes represent both people and restaurants. A person node is connected to a restaurant if that person is known to have worked at the restaurant.</p> <p>Restaurants with very many neighbor nodes (nodes connected to it) are restaurants whose alumni go on to create and work in other prestigious restaurants. This is the case of <a href="https://www.ducasse-paris.com/" rel="external nofollow noopener" target="_blank">Ducasse</a> (ok, not a restaurant but a placeholder for all the restaurants in the Ducasse brand), <a href="https://www.mandarinoriental.com/fr" rel="external nofollow noopener" target="_blank">Mandarin Oriental</a> (technically the restaurant is called Sur Mesure) or <a href="https://www.septime-charonne.fr/" rel="external nofollow noopener" target="_blank">Septime</a>.</p> <p>To visualize and analyse this network, we combine information contained in reviews of restaurants across France by <a href="https://lefooding.com" rel="external nofollow noopener" target="_blank">LeFooding.com</a>’s critics. Most reviews contain information about the staff and their CV.</p> <p>Take this (shortened) review of <a href="https://lefooding.com/restaurants/grenat" rel="external nofollow noopener" target="_blank">Grenat</a> (emphasis mine):</p> <blockquote> <p>À l’enseigne de Grenat, <strong>Antoine Joannier</strong> et <strong>Neil Mahatsry</strong> ont le rouge aux joues et aux murs. <strong>Après avoir officié à La Brasserie Communale, où ils se sont rencontrés</strong>, les deux compères font désormais feu de tout bois en plein centre de Marseille, où <strong>Antoine veille au grain autour des tables en bois blond, convoyant les plats que Neil embrase à tout-va depuis l’âtre derrière le comptoir</strong>. Des huîtres aux pièces viandardes, […]</p> </blockquote> <p>and LeFooding.com’s English version:</p> <blockquote> <p>At Grenat, <strong>Antoine Joannier</strong> and <strong>Neil Mahatsry</strong> are bathed in an ardent red glow, much like the pomegranate-toned walls of their space. <strong>After working together at La Brasserie Communale, where they first met</strong>, the duo is now firing on all cylinders in the heart of Marseille, where <strong>Antoine tends to guests seated around blonde wood tables, delivering dishes ignited by Neil behind the bar.</strong> From oysters to prime cuts of red meat, […]</p> </blockquote> <p>Notice that the review mentions the restaurant staff, their prior experience at <em>La Brasserie Communale</em> and gives their roles in the restaurant. All of this information should be included in the network. Using OpenAI’s gpt4o-mini model with its structured generation functionality, we can extract information from the 1800 publicly available <a href="https://lefooding.com" rel="external nofollow noopener" target="_blank">LeFooding.com</a> reviews going back four years. Instead of the order of 1800 “current” staff-restaurant relationships, we discover over 5000 links. We are enriching our analysis with all possible information from the reviews.</p> <p>We combine the extracted information into a graph you can explore below (or <a href="https://ouestware.gitlab.io/retina/1.0.0-beta.4/#/graph/?url=https%3A%2F%2Fgist.githubusercontent.com%2Ftheophilec%2F351f17ece36477bc48438d5ec6d14b5a%2Fraw%2Ffa85a89541c953e8f00d6774fe42f8c4bd30fa47%2Fgraph.gexf&amp;r=x&amp;sa=re&amp;ca[]=t&amp;ca[]=ra-s&amp;st[]=u&amp;st[]=re&amp;ed=u" rel="external nofollow noopener" target="_blank">click here</a>) below. To get started in exploring look for <em>Grenat</em>, Antoine, Neil or <em>Septime</em> and other restaurants we’ve mentioned.</p> <p>The network has over 5000 nodes and as many edges. In the visualization, green nodes represent staff and purple nodes represent restaurants. Larger nodes have a higher degree (more neighbors). Edges link restaurants and staff. You can it below. Look for your favorite restaurant, or click around to discover the connected components in the graph.</p> <iframe width="800" height="600" src="https://ouestware.gitlab.io/retina/1.0.0-beta.4/#/embed/?url=https%3A%2F%2Fgist.githubusercontent.com%2Ftheophilec%2F351f17ece36477bc48438d5ec6d14b5a%2Fraw%2Ffa85a89541c953e8f00d6774fe42f8c4bd30fa47%2Fgraph.gexf&amp;r=v&amp;sa=re&amp;ca[]=t&amp;ca[]=ra-s&amp;st[]=u&amp;st[]=re&amp;ed=u" frameborder="0" title="Retina" allowfullscreen=""></iframe> <h2 id="making-the-network">Making the network</h2> <p>To get here, we scraped data from <a href="https://lefooding.com" rel="external nofollow noopener" target="_blank">LeFooding.com</a>, extracted the desired information from the reviews, built the graph and finally made the visualization. The code used is available at <a href="https://github.com/theophilec/foudinge" rel="external nofollow noopener" target="_blank">theophilec/foudinge</a>.</p> <p>The crux of the approach is extracting the information is a structured way. Indeed, we need an easy was of building the graph and knowing which restaurants and people are related. Large Language Models (LLMs) are excellent in understanding a text, and can answer questions like “Where did Antoine Joannier work before Grenat?” with the Grenat review. However, if we ask for the information is a structured format like a JSON object, they struggle to reliably give useful answers.</p> <p>For instance, the desired output for the Grenat review could be something like this:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Person</span><span class="p">(</span>
  <span class="n">name</span><span class="o">=</span><span class="sh">'</span><span class="s">Antoine Joannier</span><span class="sh">'</span><span class="p">,</span>
  <span class="n">role</span><span class="o">=</span><span class="sh">'</span><span class="s">Host</span><span class="sh">'</span><span class="p">,</span>
  <span class="n">previous_restaurants</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">La Brasserie Communale</span><span class="sh">'</span><span class="p">]</span>
<span class="p">)</span>

<span class="nc">Person</span><span class="p">(</span>
  <span class="n">name</span><span class="o">=</span><span class="sh">'</span><span class="s">Neil Mahatsry</span><span class="sh">'</span><span class="p">,</span>
  <span class="n">role</span><span class="o">=</span><span class="sh">'</span><span class="s">Chef</span><span class="sh">'</span><span class="p">,</span>
  <span class="n">previous_restaurants</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">La Brasserie Communale</span><span class="sh">'</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div></div> <p>This is the art of <em>structured generation</em>.</p> <p>There are several approaches to this problem. First, one can <em>prompt better</em>. Second, and in combination with the first approach, one can retry inference until the response parses in the desired schema. While this can work as a one-off when hacking a configuration file, it won’t work for almost 2000 reviews.</p> <p>Another approach uses the logits of the model. These define the sampling distributions for the next token. They can be modified at inference to force the generated tokens to build into a response respecting a defined structure. Behind the scences, this relies on regular expressions and finite state machines (the same techniques used when <em>parsing</em> JSON). When using such techniques, you prompt the model however you want (and give the schema to inference API) and the output provably respects the desired structure 100% of the time, and can be used reliably downstream.</p> <p>The <code class="language-plaintext highlighter-rouge">outlines</code> library built by <a href="https://dottxt.co/" rel="external nofollow noopener" target="_blank">.txt</a> makes this possible for your favorite open model, such as <code class="language-plaintext highlighter-rouge">Mistral-7B-v0.3</code>. It also wraps OpenAI’s implementation of this in its API.</p> <p>Once a <a href="https://github.com/theophilec/foudinge/blob/main/foudinge/entities.py" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">prompt_template</code></a> and <a href="https://github.com/theophilec/foudinge/blob/main/foudinge/entities.py" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">Summary</code> schema</a> are designed, it’s as easy as:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span> <span class="o">=</span> <span class="bp">...</span>
<span class="n">generator</span> <span class="o">=</span> <span class="n">outlines</span><span class="p">.</span><span class="n">generate</span><span class="p">.</span><span class="nf">json</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">Summary</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="nf">generator</span><span class="p">(</span><span class="nf">prompt_template</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
</code></pre></div></div> <p>I put Mistral, Meta and OpenAI head to head. Both Llama3.2-3B and Mistral-7B-v0.3 had a tendency to hallucinate fake people and related restaurants. In the end, I opted for OpenAI gpt4o-mini, which was also much faster. But even gpt4o-mini was susceptible to mistakes, which makes me optimistic that better prompting, an improved schema design will allow me to reproduce the results with Mistral or Llama (future work).</p> <p>The total cost of inference over 2000 reviews with gpt4o-mini with its structured generation endpoint is less that 1€!</p> <p>I used <a href="https://gephi.org/gephi-lite" rel="external nofollow noopener" target="_blank">gephi-lite</a> to create work on the visualization. The key step was spatialization, which defines a spatial layout of the graph that makes sense given the information contained in the graph. In our case, I used the force simulation setting which sends connected nodes close and nodes with larger degree to the center. The embedded visualization runs using WebGL thanks to the <a href="https://ouestware.gitlab.io/retina" rel="external nofollow noopener" target="_blank">Retina</a> project<sup id="fnref:1"><a href="#fn:1" class="footnote" rel="footnote" role="doc-noteref">1</a></sup></p> <p>In order to handle duplicates and eliminating some obvious errors visible on the graph once visualized I asked Claude 3.7 Sonnet to create a simple web app to allow me to edit the inferred entities while keeping the structure intact (as well as the encoding issues caused by sqlite/myself). It only took 2 iterations to get it working as I wanted, and then a few more iterations to get full-text search and some other features. It uses Flask and pure JS in jinja templates. It is available on Github at <a href="https://github.com/theophilec/foudinge-scrub" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">foudinge-scrub</code></a> There are still a few duplicates to fix, which I’ll get around to (maybe).</p> <p>All the code used for scraping (using sqlite, asyncio and aiohttp), the inference (using outlines), the prompt and the Pydantic Schema are available on Github at <a href="https://github.com/theophilec/foudinge" rel="external nofollow noopener" target="_blank">theophilec/foudinge</a>.</p> <h3 id="conclusion">Conclusion</h3> <p>This project illustrates how LLMs can be used to extract information from rich sources of textual data, in this instance restaurant reviews. I am very happy with the tools I chose. A good next step is to get all this running of open models, locally or in a public cloud.</p> <p><em>Thanks to Adrien Bocquet and Clotilde Bukato for proofreading earlier versions of this post.</em></p> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:1"> <p>I identified and reported an <a href="https://github.com/gephi/gephi-lite/issues/187" rel="external nofollow noopener" target="_blank">issue</a> in gephi-lite where string escaping prevented proper Retina imports. It is now fixed in production. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">↩</a></p> </li> </ol> </div> </div> </article> </div> </div> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?da39b660470d1ba6e6b8bf5f37070b6e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script data-goatcounter="https://theophilec.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script> </body> </html>