<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Mapping the French Culinary Universe | Théophile Cantelobre </title> <meta name="author" content="Théophile Cantelobre"> <meta name="description" content="Creating a knowledge graph of restaurants featured in lefooding.com reviews using `outlines` and `gpt4o-mini`."> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%9A%80&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://theophilec.github.io/blog/2025/foudinge/"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Théophile</span> Cantelobre </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog <span class="sr-only">(current)</span> </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Mapping the French Culinary Universe</h1> <p class="post-meta"> February 27, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/category/llm"> <i class="fa-solid fa-tag fa-sm"></i> llm</a>   <a href="/blog/category/food"> <i class="fa-solid fa-tag fa-sm"></i> food</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>For French restaurant intel, lefooding.com is the definitive data source. Their anonymous critics conduct systematic reviews of establishments across France (and now Belgium), documenting their findings in a witty - if peculiar - style. Turns out we can use them to map France’s culinary universe.</p> <p>Explore the universe in this graph (<a href="https://ouestware.gitlab.io/retina/1.0.0-beta.4/#/graph/?url=https%3A%2F%2Fgist.githubusercontent.com%2Ftheophilec%2F351f17ece36477bc48438d5ec6d14b5a%2Fraw%2Ffa85a89541c953e8f00d6774fe42f8c4bd30fa47%2Fgraph.gexf&amp;r=x&amp;sa=re&amp;ca[]=t&amp;ca[]=ra-s&amp;st[]=u&amp;st[]=re&amp;ed=u" rel="external nofollow noopener" target="_blank">Direct link to the visualization</a>). Purple nodes are restaurants and green nodes are people. Larger nodes have a higher degree. Click around to see neighbors and discover components.</p> <iframe width="800" height="600" src="https://ouestware.gitlab.io/retina/1.0.0-beta.4/#/embed/?url=https%3A%2F%2Fgist.githubusercontent.com%2Ftheophilec%2F351f17ece36477bc48438d5ec6d14b5a%2Fraw%2Ffa85a89541c953e8f00d6774fe42f8c4bd30fa47%2Fgraph.gexf&amp;r=v&amp;sa=re&amp;ca[]=t&amp;ca[]=ra-s&amp;st[]=u&amp;st[]=re&amp;ed=u" frameborder="0" title="Retina" allowfullscreen=""></iframe> <p>Some interesting insights from the graph:</p> <ul> <li>Look for Septime or Ducasse. Each of these has helped raise chefs that go on to be chefs in other restaurants (including their own).</li> <li>Explore around Caillebotte and find all the sister restaurants listed <a href="https://www.lapantruchoise.com/" rel="external nofollow noopener" target="_blank">online</a>.</li> </ul> <blockquote> <p>Share your insights and I’ll add them here!</p> </blockquote> <h1 id="what-am-i-looking-at-">What am I looking at ?</h1> <p>The graph above combines information about serveral thousand entities (people and restaurants) and relations between them from 1 800 publicly available lefooding.com reviews.</p> <p>For instance, take this review of <em>Grenat</em>:</p> <blockquote> <p>À l’enseigne de Grenat, Antoine Joannier et Neil Mahatsry ont le rouge aux joues et aux murs. Après avoir officié à La Brasserie Communale, où ils se sont rencontrés, les deux compères font désormais feu de tout bois en plein centre de Marseille, où Antoine veille au grain autour des tables en bois blond, convoyant les plats que Neil embrase à tout-va depuis l’âtre derrière le comptoir. Des huîtres aux pièces viandardes, en passant par la verdure et le poisson, tout y flambe, fume, grille, cuit à l’étouffée ou se voit marqué au fer à repasser brocanté. Dans nos assiettes ce midi-là, une marinière de moules et palourdes à la flamme, dopée par un bouillon de bœuf et de la ‘nduja, suivie d’un torride tentacule de poulpe accompagné de chou frisé grillé et d’une tapenade d’olives de Kalamata fumée… Même les desserts y passent, comme cette glace au lait fermenté et encore fumé, flanquée d’une ganache au chocolat blanc caramélisée et toppée d’un granola aux noix. Du mercredi au vendredi soir, le ton et les prix montent d’un cran pour faire place au menu en huit temps.</p> </blockquote> <p>Beyond the merits of the food and ambiance, it gives valuable information about the people who work at Grenat (Antoine Joannier and Neil Mahatsry), about their roles and where they worked before. This information is part of the graph:</p> <p><img src="/assets/img/grenat.png" alt="Grenat in the graph"></p> <p>All the code used can be found on <a href="https://github.com/theophilec/foudinge" rel="external nofollow noopener" target="_blank">Github</a>.</p> <h1 id="approach">Approach</h1> <p>The approach follows a straightforward process. For each restaurant review, we extract specific information (people, roles, relationships). Then, we combine the information into a graph, highlighting connected entities, components, … The graph can then be visualized and analyzed. This differs from a RAG (Retrieval-Augmented Generation) approach. With RAG, we would embed reviews and let an LLM answer queries about the corpus (like “Where did Antoine Joannier and Neil Mahatsry meet before working at Grenat?”). While that would be possible, it’s not our focus here (future work?).</p> <p>The key challenge in our approach is ensuring extracted entities maintain a consistent structure. LLMs struggle with producing JSON according to a given schema. Simply asking a model via prompting to “give me valid JSON and nothing else” typically results in inconsistent formatting, extra text, or invalid structures.</p> <p>Using the logits of a model, one can modify the sampling probabilities to enforce the generated tokens to build into valid JSON according to a given schema. OpenAI implements this in its API. When using an open model like Mistral-7B-v0.3 or Llama3.2-3B, we use <code class="language-plaintext highlighter-rouge">outlines</code> from <a href="https://dottxt.co/" rel="external nofollow noopener" target="_blank">.txt</a>. Both use a finite automaton approach like for applying a regular expression.</p> <p>There is three steps in building the graph:</p> <ol> <li>Get the data from lefooding.com</li> <li>Extracting information from each review (inferring entities)</li> <li>Building a graph</li> <li>Making the visualization</li> </ol> <p>The code used is available at <a href="https://github.com/theophile/foudinge" rel="external nofollow noopener" target="_blank">theophilec/foudinge</a>.</p> <h2 id="1-get-the-data-from-lefoodingcom">1. Get the data from lefooding.com</h2> <p>We first gather all review URLs from lefooding.com’s directory by paginating through all listings. Then we scrape each review page for its title and text content. To prevent data loss from network failures, we implement asynchronous batch processing and store results in a SQLite database after each completed batch.</p> <h2 id="2-inferring-entities">2. Inferring entities</h2> <p>For the Grenat review above, we aim at getting:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Person(
  name='Antoine Joannier',
  role='Host',
  previous_restaurants=['La Brasserie Communale']
)

Person(
  name='Neil Mahatsry',
  role='Chef',
  previous_restaurants=['La Brasserie Communale']
)
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">outlines</code> is a library for constraining LLM output to a JSON schema (more generally a regular expression) using the logits. OpenAI also exposes such functionality through its API (which <code class="language-plaintext highlighter-rouge">outlines</code> wraps). We define the structure through a <code class="language-plaintext highlighter-rouge">pydantic</code> model:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Role</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="n">CHEF</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Chef</span><span class="sh">"</span>
    <span class="n">SOMMELIER</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Sommelier</span><span class="sh">"</span>
    <span class="n">SERVER</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Serveur</span><span class="sh">"</span>
    <span class="n">OWNER</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Propriétaire</span><span class="sh">"</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">role</span><span class="p">:</span> <span class="n">Role</span>
    <span class="n">previous_restaurants</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">Summary</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">people</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span>
</code></pre></div></div> <p>with the following prompt template:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">prompt_template</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="sh">"""</span><span class="s">
    Tu es un expert gastronomique basé sur l</span><span class="sh">'</span><span class="s">IA. Tu es chargé d</span><span class="sh">'</span><span class="s">extraire les informations suivantes de manière structurée d</span><span class="sh">'</span><span class="s">une critique de restaurant.

    Pour chaque personne impliquée dans le restaurant, indique:

    1. Son nom, dans le champ </span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="s">.

    2. Son rôle, dans le champ </span><span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="s">. Choisis parmi les options suivantes : </span><span class="sh">"</span><span class="s">Chef</span><span class="sh">"</span><span class="s"> (ceux qui cuisinent), </span><span class="sh">"</span><span class="s">Sommelier</span><span class="sh">"</span><span class="s"> (ceux qui s</span><span class="sh">'</span><span class="s">occupent des boissons), </span><span class="sh">"</span><span class="s">Serveur</span><span class="sh">"</span><span class="s"> (ceux qui servent en salle), </span><span class="sh">"</span><span class="s">Propriétaire</span><span class="sh">"</span><span class="s"> (propriétaire ou patron du restaurant), </span><span class="sh">"</span><span class="s">Fournisseur</span><span class="sh">"</span><span class="s"> (ceux qui fournissent les produits : légumes, fruits, viandes, poissons, fruits de mer...) Attention, tous les rôles peuvent être tenus par un homme ou une femme.

    3. Les noms des restaurants dans lesquels il a travaillé précédemment, dans le champ </span><span class="sh">"</span><span class="s">previous_restaurants</span><span class="sh">"</span><span class="s"> sous la forme d</span><span class="sh">'</span><span class="s">une liste. Si aucun restaurant précédent n</span><span class="sh">'</span><span class="s">est mentionné, n</span><span class="sh">'</span><span class="s">inclus pas le champ. N</span><span class="sh">'</span><span class="s">inclus pas d</span><span class="sh">'</span><span class="s">information sur la localisation de ces restaurants.

    Attention à ne mentionner que des personnes impliquées dans le restaurant et pas des personnes mentionnées dans la critique (des célébrités, ...).

    Attention à n</span><span class="sh">'</span><span class="s">inclure que les personnes présentes dans la critique. N</span><span class="sh">'</span><span class="s">invente pas de personne fictive ni de placeholder (</span><span class="sh">"</span><span class="s">anonyme</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">personne fictive</span><span class="sh">"</span><span class="s">, ...).

    Texte de la critique à résumer :
        </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s">

    N</span><span class="sh">'</span><span class="s">inclut que les résultats aucune autre information ou explication.

    Ta réponse doit être structurée dans un format JSON valide:
        </span><span class="si">{</span><span class="n">schema</span><span class="si">}</span><span class="s">
    </span><span class="sh">"""</span>
</code></pre></div></div> <p>The syntax is then to take a compatible <code class="language-plaintext highlighter-rouge">model</code> and use the generator API in <code class="language-plaintext highlighter-rouge">outlines</code>:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span> <span class="o">=</span> <span class="bp">...</span>
<span class="n">generator</span> <span class="o">=</span> <span class="n">outlines</span><span class="p">.</span><span class="n">generate</span><span class="p">.</span><span class="nf">json</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">Summary</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="nf">generator</span><span class="p">(</span><span class="nf">prompt_template</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
</code></pre></div></div> <p>where, in the end, <code class="language-plaintext highlighter-rouge">result</code> is a <code class="language-plaintext highlighter-rouge">Summary</code> object.</p> <p>Like <code class="language-plaintext highlighter-rouge">outlines</code>, I too am GPU poor. I tried several models on my M1 MBP, but opted for using a larger GPU, in one of two ways. First, I computed entities of a subset of reviews using the <code class="language-plaintext highlighter-rouge">mistralai/Mistral-7B-v0.3</code> model OVH’s AI notebook (which give 200 euros free credit, i.e. 100+ hours of inference). Since the results were not great (and inference quite slow), I tried using <code class="language-plaintext highlighter-rouge">gpt4o-mini</code>’s structured generation API through <code class="language-plaintext highlighter-rouge">outlines</code>, which gave good results. The cost of inference on <code class="language-plaintext highlighter-rouge">gpt4o-mini</code> is tiny at &lt; 1€ (including the almost 2k reviews and quite a bit of testing before).</p> <blockquote> <p>Future work: get an open model to work with the help of <code class="language-plaintext highlighter-rouge">outlines</code> (they have office hours, I am going to try to go to the next ones)!</p> </blockquote> <p>I created <a href="https://github.com/theophilec/foudinge-scrub" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">foudinge-scrub</code></a> as a small web app to help clean the entities to correct errors while maintaining the schemas. This was coded in 6 iterations using Claude 3.7 Sonnet, and is way beyond my web development skills. It has full text search (the more advanced search does not work). There is also a small script to detecting duplicates. There are still a few duplicates to fix, which I’ll get around to.</p> <h2 id="visualization">Visualization</h2> <p>The extracted entities are converted to a graph format and visualized using <a href="https://gephi.org/gephi-lite/" rel="external nofollow noopener" target="_blank">gephi-lite</a>. The spatialized graph - putting nodes with higher degrees more to the center - is hosted on Github Gist and rendered through <a href="https://ouestware.gitlab.io/retina" rel="external nofollow noopener" target="_blank">Retina</a> in the iframe above.</p> <blockquote> <p>Note: I identified and reported an <a href="https://github.com/gephi/gephi-lite/issues/187" rel="external nofollow noopener" target="_blank">issue</a> in gephi-lite where string escaping prevented proper Retina imports. This has been fixed in the main branch.</p> </blockquote> </div> </article> </div> </div> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?da39b660470d1ba6e6b8bf5f37070b6e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script data-goatcounter="https://theophilec.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script> </body> </html>